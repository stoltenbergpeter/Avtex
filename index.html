
<head>
  <title>Peter's Web Messaging Form Example</title>
  <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
  <base target="top">
  <style>
    .center {
      margin: auto;
      width: 40%;
      border: 3px solid #73AD21;
      padding: 10px;
    }
  </style>
  <script type="text/javascript" charset="utf-8">
   (function (g, e, n, es, ys) {
    g['_genesysJs'] = e;
    g[e] = g[e] || function () {
      (g[e].q = g[e].q || []).push(arguments)
    };
    g[e].t = 1 * new Date();
    g[e].c = es;
    ys = document.createElement('script'); ys.async = 1; ys.src = n; ys.charset = 'utf-8'; document.head.appendChild(ys);
  })(window, 'Genesys', 'https://apps.mypurecloud.com/genesys-bootstrap/genesys.min.js', {
    environment: 'use1',
    deploymentId: '50d5f3cb-a9da-4832-8e5a-d1c323f5bf0d'
  });

     
 
  </script>
  </head>
  <body style="font-family:Helvetica;">
  <h1>Peter's Web Messaging Testing</h1>
  <table>
    <tr>
      <td colspan="2"><h3>Messenger Configuration</h3></td>
    </tr>
    <tr>
      <td>Deployment Name</td>
      <td>PKS Deployment</td>
    </tr>
    <tr>
      <td>Deployment Key</td>
      <td>50d5f3cb-a9da-4832-8e5a-d1c323f5bf0d</td>
    </tr>
  </table>
  <br>
  <div id="datacollectionform" class="center">
  <table>
    <tr>
      <td colspan="2"><h3>Sample Data Collection Form</h3></td>
    </tr>
    <tr>
      <td>Choose Routing Key</td>
      <td>
        <select name="routekey" id="routingkey">
          <option value="Skill One">Avtex</option>
          <option value="Skill Two">General</option>
         
        </select>
    </td>
    </tr>
    <tr>
      <td>Full Name</td>
      <td><input type="text" id="fullname" name="fullname"></td>
    </tr>
   
    <tr>
      <td></td>
      <td><button name="chatnow" id="chatnow" onclick="startWebMessaging()">Chat Now</button></td>
    </tr>
  </table>
  </div>
  
  <script type="text/javascript" charset="utf-8">
  let suppressMessenger = true;
  
  // Check for Local Storage Support
  function localStorageSupported() {
    try {
      return "localStorage" in window && window["localStorage"] !== null;
    } catch (e) {
      return false;
    }
  }

function clearData() {
    try {
      localStorage.setItem('_actmu','');
      localStorage.setItem('_actms','');
      localStorage.setItem('_actts','');
      localStorage.setItem('_actvc','');
      console.log("_actmu data cleared");
    } catch (e) {
      console.log("_actmu clear error");
      return false;
    }
  };

  function showLauncher(){
    Genesys("command", "Launcher.show");
  }
  
  
  $( document ).ready(function() {
          console.log("document loaded");
          if (localStorageSupported) {
            console.log("local storage supported");
            localStorage.setItem('showLauncher',false);
            console.log("showLauncher to false");
          }
  });
  
    // Subscribe to events
    Genesys("subscribe", "Messenger.opened", function(o){
      console.log("Messenger open event try to close window");
      
        if (suppressMessenger == true)
          {
            //window.setTimeout(closeMessenger, 2000);
          }
  
    });

  
    // Try to close messenger window and hide launcher if visible
    function closeMessenger(){
      Genesys("command", "Launcher.hide");
      Genesys("command", "Messenger.close", {},
        function(o){
          console.log("Closed Messenger Window");
        },  // if resolved
        function(o){    // if rejected
          console.log("Failed Messenger Close");
          
        }
      );
    }
  
  // function to start a web message, send data to Genesys Cloud and disply Messenger window 
  function startWebMessaging() {
    var fullName = document.getElementById("fullname").value;
    var Topic = document.getElementById("topic").options[document.getElementById("topic").selectedIndex].value;
    var routingKey = document.getElementById("routingkey").options[document.getElementById("routingkey").selectedIndex].value;
  
    suppressMessenger = false;
  
    //Hide Data Collection Form
    document.getElementById("datacollectionform").style.display = "none";

    // Set Form Value
    if (localStorageSupported) {
        console.log("local storage supported");
        localStorage.setItem('showLauncher',true);
        console.log("showLauncher to true");
    }
  
    // Set Custom Attribute
    Genesys("command", "Database.set", {
                    messaging: {
                        customAttributes: {
                        "RoutingKey": routingKey,
                        "MemberName": fullName,
                        "FinalIntent":Topic
                        }
                }
            });
  
      //Open Messenger Window
      Genesys("command", "Messenger.open"); 
      Genesys("command", "Launcher.show");
  }
  </script>
  

  <button id="cleardata" onclick="clearData()">Clear _actmu Data</button>
  <button id="showlauncher" onclick="showLauncher()">Show Launcher</button>
  <br>

  </body>
  </html>
<!DOCTYPE html>

       

